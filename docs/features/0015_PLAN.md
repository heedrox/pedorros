# PLAN TÉCNICO: Evitar caché en archivos estáticos

## Descripción del contexto
El usuario quiere evitar que el navegador cachee los archivos estáticos cuando alguien accede a `index.html`. Específicamente, necesita que cada vez que se acceda a la página, se recarguen `styles.css`, `script.js`, `firebase-config.js`, `firebase-database.js` y en general todos los archivos JavaScript desde fuera de la caché.

## Archivos que deben modificarse

### 1. `web/index.html`
- **Líneas 7**: Modificar el link de `styles.css` para incluir parámetro de versión
- **Líneas 158**: Modificar el script de `script.js` para incluir parámetro de versión

### 2. `web/script.js`
- **Líneas 1-50**: Modificar las importaciones de módulos para incluir parámetros de versión
- **Líneas 25-35**: Modificar importaciones de `firebase-config.js` y `firebase-database.js`
- **Líneas 40**: Modificar importación de `audio.js`

### 3. `web/firebase-database.js`
- **Líneas 1-10**: Modificar importación de `firebase-config.js`

### 4. `web/audio.js`
- **Líneas 1-44**: No requiere cambios (es un módulo independiente)

## Algoritmo de implementación

### Fase 1: Implementación de parámetros de versión
1. **Generar timestamp único**: Crear una función que genere un timestamp único para cada carga de página
2. **Modificar referencias CSS**: Añadir parámetro `?v={timestamp}` al link de `styles.css`
3. **Modificar referencias JavaScript**: Añadir parámetro `?v={timestamp}` a todas las importaciones de módulos

### Fase 2: Implementación de mecanismo de versión
1. **Función de generación de versión**: Implementar función que genere un identificador único por sesión
2. **Aplicación de parámetros**: Modificar todas las URLs de recursos estáticos para incluir el parámetro de versión
3. **Consistencia de versiones**: Asegurar que todos los archivos usen la misma versión en una sesión

## Detalles técnicos específicos

### Generación de versión
- Usar `Date.now()` o `performance.now()` para generar timestamp único
- Alternativa: usar `Math.random()` para generar identificador aleatorio
- Considerar usar `sessionStorage` para mantener consistencia durante la sesión

### Modificación de URLs
- CSS: `<link rel="stylesheet" href="styles.css?v={version}">`
- JavaScript: `<script type="module" src="script.js?v={version}">`
- Importaciones ES6: `import { ... } from './firebase-config.js?v={version}'`

### Compatibilidad
- Asegurar que los parámetros de query no interfieran con la funcionalidad de módulos ES6
- Verificar que Firebase CDN siga funcionando correctamente
- Mantener compatibilidad con navegadores modernos

## Consideraciones de implementación

### Ventajas
- Fuerza la recarga de archivos estáticos en cada acceso
- No requiere configuración del servidor
- Implementación simple y directa

### Desventajas
- Aumenta el tiempo de carga inicial
- Puede incrementar el uso de ancho de banda
- Los archivos no se pueden cachear entre sesiones

### Alternativas consideradas
- Headers HTTP de cache-control (requiere configuración del servidor)
- Service Workers para control de caché (más complejo)
- Versionado basado en hash de contenido (requiere build process)

## Fases de implementación

### Fase 1: Implementación básica
- Modificar `index.html` para incluir parámetros de versión
- Modificar `script.js` para importaciones con versión
- Modificar `firebase-database.js` para importación con versión

### Fase 2: Testing y validación
- Verificar que todos los archivos se recargan correctamente
- Comprobar que no hay errores de importación
- Validar que la funcionalidad del juego sigue funcionando

### Fase 3: Implementación del build process
- Crear script `build.js` para generar versiones automáticamente
- Configurar `package.json` con scripts de build
- Automatizar el proceso de cache-busting

### Fase 4: Optimización (opcional)
- Implementar versión basada en timestamp de archivo
- Añadir opción para deshabilitar el anti-caché
- Considerar implementar cache-busting inteligente

## Archivos adicionales a crear

### 5. `build.js` (nuevo)
- Script Node.js para procesar archivos HTML y JavaScript
- Generación automática de timestamps únicos
- Inserción de parámetros de versión en todas las referencias

### 6. `package.json` (modificar)
- Añadir scripts de build: `npm run build` y `npm run build:watch`
- Configurar dependencias necesarias para el build process
