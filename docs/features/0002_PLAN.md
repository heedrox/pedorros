# PLAN TÉCNICO - Login Anónimo con Firebase

## Descripción de la Funcionalidad

Implementar un sistema de autenticación anónima con Firebase que controle el acceso a la aplicación PEDORROS. Cuando un usuario no está autenticado, se mostrará únicamente el título "PEDORROS" y un botón "ACCEDER" centrado en la pantalla. Solo después de autenticarse exitosamente se ejecutará la lógica del juego existente.

**Prompt del usuario**: "En la aplicacion, tenemos que hacer login anonimo con firebase. Si se detecta que no estás logeado, se tiene que mostrar 'ACCEDER' en un botón en medio (y solo eso), con el titulo de PEDORROS. Cuando se pulsa ACCEDER, y estamos logeados en firebase, y se detecta que estamos logeados, es entonces cuando se ejecuta la lógica del juego en sí."

## Archivos y Funciones a Modificar/Crear

### Archivos a Crear:
- `web/firebase-config.js` - Configuración de Firebase y funciones de autenticación

### Archivos a Modificar:
- `web/index.html` - Añadir pantalla de login y modificar estructura existente
- `web/script.js` - Integrar sistema de autenticación y control de flujo
- `web/lib.js` - Añadir funciones de autenticación al core
- `web/styles.css` - Nuevos estilos para la pantalla de login

## Algoritmo y Lógica de Implementación

### Fase 1: Configuración de Firebase (Capa de Datos)
1. **Configurar Firebase** con autenticación anónima habilitada
2. **Crear funciones de autenticación** en `firebase-config.js`:
   - `signInAnonymously()` - Login anónimo
   - `getCurrentUser()` - Obtener usuario actual
   - `onAuthStateChanged()` - Listener de cambios de autenticación
3. **Definir estados de autenticación** en el core de la aplicación

### Fase 2A: Interfaz de Usuario
1. **Crear pantalla de login** con título "PEDORROS" y botón "ACCEDER"
2. **Modificar pantalla existente** para ocultarla cuando no hay autenticación
3. **Implementar transición visual** entre estados de login y juego
4. **Añadir indicador de carga** durante el proceso de autenticación

### Fase 2B: Lógica de Control de Flujo
1. **Modificar `initializeApp()`** para verificar autenticación antes de inicializar el juego
2. **Implementar listener de Firebase** para detectar cambios de autenticación
3. **Controlar renderizado** basado en el estado de autenticación
4. **Mantener estado inmutable** del usuario autenticado

## Detalles Técnicos Específicos

### Estados de Autenticación
- `AUTHENTICATING` - Proceso de login en curso
- `AUTHENTICATED` - Usuario autenticado, mostrar juego
- `UNAUTHENTICATED` - Usuario no autenticado, mostrar login

### Flujo de Autenticación
1. **Carga inicial**: Verificar si hay usuario autenticado
2. **Sin autenticación**: Mostrar pantalla de login
3. **Click en ACCEDER**: Ejecutar `signInAnonymously()`
4. **Autenticación exitosa**: Ocultar login, mostrar juego
5. **Persistencia**: Mantener sesión entre recargas de página

### Estructura de Datos
- **Usuario anónimo**: Firebase genera UID único
- **Estado de autenticación**: Integrado con el estado del juego existente
- **Persistencia**: Firebase mantiene la sesión automáticamente

### Manejo de Errores
- **Errores de red**: Mostrar mensaje de error temporal
- **Errores de Firebase**: Fallback a estado no autenticado
- **Timeout de autenticación**: Límite de tiempo para el proceso

## Consideraciones de Implementación

### Filosofía Small Safe Steps
- **Paso 1**: Configurar Firebase y crear funciones básicas de autenticación
- **Paso 2**: Implementar pantalla de login con estilos básicos
- **Paso 3**: Integrar autenticación en el flujo principal de la aplicación
- **Paso 4**: Añadir manejo de errores y mejoras de UX

### Testing y Validación
- **Verificar autenticación anónima** funciona correctamente
- **Confirmar persistencia** de sesión entre recargas
- **Validar transiciones** entre estados de login y juego
- **Probar manejo de errores** de red y Firebase

### Seguridad y Privacidad
- **Autenticación anónima**: No requiere datos personales
- **UID único**: Firebase genera identificador único para cada sesión
- **Sin persistencia local**: Solo Firebase mantiene el estado

### Integración con Sistema Existente
- **Mantener arquitectura inmutable** del core existente
- **Preservar funciones existentes** del juego
- **Añadir capa de autenticación** sin modificar lógica de negocio

## Próximos Pasos (Futuras Fases)
- Implementar sincronización en tiempo real con Firebase Database
- Añadir sistema de roles y permisos por usuario
- Implementar persistencia de datos del juego por sesión
- Crear sistema de invitaciones y códigos de juego

## Dependencias Técnicas
- Firebase SDK ya incluido en `package.json`
- Configuración de proyecto Firebase (archivo de configuración)
- Habilitar autenticación anónima en consola de Firebase
