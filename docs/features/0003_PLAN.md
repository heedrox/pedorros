# PLAN TÉCNICO - Botón REINICIAR para Jugador 1

## Descripción de la Funcionalidad

Implementar un botón "REINICIAR" que solo será visible para el jugador 1 (el director del juego) en la zona superior derecha de la pantalla. Este botón permitirá reiniciar completamente el estado del juego, guardando en Firebase Database un documento de reinicio con la estructura especificada.

**Prompt del usuario**: "Ahora para el jugador 1, vamos a hacer que exista (y que solo vea el jugador 1) un botón arriba a la derecha que ponga 'REINICIAR'. Este botón lo que hará será meter en BD un reinicio del juego. En la BD vamos a meter el documento: /pedorros-game/CODIGO_JUEGO. Siendo 'CODIGO_JUEGO' el campo que se ve en /g/XXXX/p/... en la URL, es decir, si abres http://127.0.0.1:51541/?/g/galerna/p/1/5 sería 'galerna' en nuestros ejemplos. El documento a guardar de reinicio será: { ranking: {}, lastResult: null, numRound: 1, state: 'START', nextSounds: {}, pedorroSound: null }"

## Archivos y Funciones a Modificar/Crear

### Archivos a Crear:
- `web/firebase-database.js` - Funciones para interactuar con Firebase Realtime Database

### Archivos a Modificar:
- `web/index.html` - Añadir botón REINICIAR en el header
- `web/script.js` - Lógica de visibilidad del botón y manejo del click
- `web/styles.css` - Estilos para el botón REINICIAR
- `web/lib.js` - Funciones del core para manejo del reinicio

## Algoritmo y Lógica de Implementación

### Fase 1: Configuración de Firebase Database (Capa de Datos)
1. **Configurar Firebase Realtime Database** en `firebase-config.js`
2. **Crear funciones de base de datos** en `firebase-database.js`:
   - `resetGameState(gameCode)` - Función para reiniciar el estado del juego
   - `getDatabaseRef()` - Obtener referencia a la base de datos
3. **Definir estructura de datos** del estado de reinicio según especificación del usuario

### Fase 2A: Interfaz de Usuario
1. **Añadir botón REINICIAR** en el header de la pantalla START
2. **Implementar lógica de visibilidad** - solo visible para jugador 1
3. **Posicionar en zona superior derecha** según especificación del usuario
4. **Añadir estilos** que mantengan la temática marrón existente

### Fase 2B: Lógica de Control y Base de Datos
1. **Modificar `renderStartScreen()`** para mostrar/ocultar botón según número de jugador
2. **Implementar event listener** para el botón REINICIAR
3. **Crear función de reinicio** que guarde en Firebase la estructura especificada
4. **Manejar confirmación** del usuario antes de ejecutar el reinicio

## Detalles Técnicos Específicos

### Estructura de Datos del Reinicio
```javascript
{
    ranking: {},
    lastResult: null,
    numRound: 1,
    state: "START",
    nextSounds: {},
    pedorroSound: null
}
```

### Ruta de Firebase Database
- **Formato**: `/pedorros-game/{CODIGO_JUEGO}`
- **Ejemplo**: `/pedorros-game/galerna` para URL `/g/galerna/p/1/5`
- **Acceso**: Solo lectura/escritura para usuarios autenticados

### Lógica de Visibilidad del Botón
- **Condición**: `playerNumber === 1`
- **Ubicación**: Header, zona superior derecha
- **Estado**: Siempre visible cuando se cumple la condición
- **Persistencia**: Visible en todas las rondas para el jugador 1

### Flujo de Reinicio
1. **Click en REINICIAR**: Mostrar confirmación al usuario
2. **Confirmación**: Ejecutar función de reinicio
3. **Escritura en BD**: Guardar documento de reinicio en Firebase
4. **Feedback**: Mostrar confirmación de éxito o error
5. **Estado local**: Mantener estado actual hasta próxima sincronización

## Consideraciones de Implementación

### Filosofía Small Safe Steps
- **Paso 1**: Configurar Firebase Database y crear funciones básicas
- **Paso 2**: Implementar botón REINICIAR con estilos básicos
- **Paso 3**: Integrar lógica de visibilidad según número de jugador
- **Paso 4**: Implementar funcionalidad de reinicio en base de datos
- **Paso 5**: Añadir confirmación y manejo de errores

### Testing y Validación
- **Verificar visibilidad** del botón solo para jugador 1
- **Confirmar escritura** correcta en Firebase Database
- **Validar estructura** del documento de reinicio
- **Probar con diferentes códigos** de juego
- **Verificar manejo de errores** de base de datos

### Seguridad y Permisos
- **Autenticación requerida**: Solo usuarios autenticados pueden reiniciar
- **Validación de jugador**: Solo jugador 1 puede ejecutar la acción
- **Reglas de Firebase**: Configurar permisos de lectura/escritura apropiados

### Integración con Sistema Existente
- **Mantener arquitectura inmutable** del core existente
- **Preservar funciones existentes** del juego
- **Añadir funcionalidad de reinicio** sin modificar lógica de negocio existente
- **Integrar con sistema de autenticación** ya implementado

## Próximos Pasos (Futuras Fases)
- Implementar sincronización en tiempo real del estado del juego
- Añadir sistema de roles y permisos por usuario
- Implementar persistencia de datos del juego por sesión
- Crear sistema de invitaciones y códigos de juego

## Dependencias Técnicas
- Firebase SDK ya incluido en `package.json`
- Firebase Realtime Database habilitado en consola de Firebase
- Reglas de seguridad configuradas para permitir lectura/escritura autenticada
- Configuración de proyecto Firebase existente

## Estructura de Archivos Modificados

### web/index.html
- Añadir botón REINICIAR en el header de start-screen
- Mantener estructura existente de pantallas

### web/script.js
- Modificar `renderStartScreen()` para control de visibilidad del botón
- Añadir event listener para botón REINICIAR
- Integrar con funciones de Firebase Database

### web/styles.css
- Estilos para botón REINICIAR
- Posicionamiento en zona superior derecha
- Mantener temática marrón existente

### web/lib.js
- Función `isPlayerOne(gameState)` para validar si es jugador 1
- Función `getResetGameState()` para generar estado de reinicio

### web/firebase-database.js (NUEVO)
- Configuración de Firebase Realtime Database
- Función `resetGameState(gameCode)` para reiniciar juego
- Manejo de errores y confirmaciones de escritura
