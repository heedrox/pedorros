# PLAN TCNICO - Sonidos Intro y Pedorro antes del Bot贸n INVESTIGAR

## Descripci贸n de la Funcionalidad

Cuando acabe la cuenta regresiva del countdown y si eres el jugador 1, antes de que aparezca el bot贸n "() INVESTIGAR", debe reproducirse la secuencia de sonidos:
1. `sounds/intro/intro.mp3` (duraci贸n: 3 segundos)
2. Sonido de pedorro correspondiente (`pedorro-X.mp3`, donde X es el valor de la BD `/pedorros-game/{configjuego}/pedorro`)
3. Esperar 1.5 segundos adicionales
4. Finalmente mostrar el bot贸n "() INVESTIGAR"

**Timing total**: 3s (intro) + duraci贸n del sonido pedorro + 1.5s = ~5.5-6.5 segundos antes del bot贸n.

## Archivos y Funciones que Deben Cambiarse

### Archivos Principales
- `web/script.js` - L贸gica de DOM y secuencia de sonidos
- `web/lib.js` - Funciones del core (opcional, para mantener consistencia)

### Funciones Espec铆ficas a Modificar
- `startDisimularSequence()` - Secuencia principal de DISIMULAR
- `showInvestigarButton()` - Mostrar bot贸n de investigar
- `playSound()` - Reproducci贸n de sonidos

### Funciones a Crear
- `playIntroAndPedorroSound()` - Nueva funci贸n para la secuencia de sonidos espec铆fica

## Algoritmo Paso a Paso

### Fase 1: Modificaci贸n de la Secuencia DISIMULAR

1. **Modificar `startDisimularSequence()`**:
   - Despu茅s del contador (5,4,3,2,1,0) y "DISIMULANDO"
   - Para jugador 1: llamar a `playIntroAndPedorroSound()`
   - Para otros jugadores: esperar 3 segundos y continuar normalmente

2. **Crear `playIntroAndPedorroSound()`**:
   - Reproducir `intro.mp3` inmediatamente
   - Esperar 3 segundos (duraci贸n del intro)
   - Obtener valor de `/pedorros-game/{configjuego}/pedorro` desde Firebase
   - Reproducir `pedorro-{valor}.mp3`
   - Esperar 1.5 segundos adicionales
   - Llamar a `showInvestigarButton()`

3. **Modificar `showInvestigarButton()`**:
   - Eliminar la l贸gica de timing actual
   - Solo mostrar el bot贸n/texto seg煤n el rol del jugador

### Fase 2: Integraci贸n con Firebase

1. **Obtener valor del pedorro**:
   - Usar funci贸n existente `getGameRoles(gameCode)` para obtener `pedorro`
   - El valor ya est谩 disponible en el estado del juego

2. **Manejo de errores**:
   - Si no se puede obtener el valor del pedorro, usar `pedorro-1.mp3` como fallback
   - Si falla la reproducci贸n del intro, continuar con el sonido del pedorro

### Fase 3: Optimizaci贸n de Timing

1. **Precarga de audio**:
   - Precargar `intro.mp3` al inicio de la secuencia DISIMULAR
   - Precargar el sonido del pedorro correspondiente

2. **Sincronizaci贸n**:
   - Usar `setTimeout` con promesas para timing preciso
   - Mantener compatibilidad con Web Audio API y HTML5 Audio

## Detalles de Implementaci贸n

### Cambios en `startDisimularSequence()`
```javascript
// Despu茅s de "DISIMULANDO" y esperar 3 segundos
if (isPlayerOne(gameState)) {
    // Para jugador 1: secuencia especial de sonidos
    await playIntroAndPedorroSound();
} else {
    // Para otros jugadores: esperar 3 segundos y continuar
    await new Promise(resolve => setTimeout(resolve, 3000));
}

// Ocultar contenedor de disimular y mostrar bot贸n de investigar
disimularContainer.style.display = 'none';
showInvestigarButton();
```

### Nueva Funci贸n `playIntroAndPedorroSound()`
```javascript
const playIntroAndPedorroSound = async () => {
    try {
        // 1. Reproducir intro.mp3
        await playSoundWebAudio('intro/intro.mp3', 0);
        
        // 2. Esperar 3 segundos
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        // 3. Obtener valor del pedorro desde Firebase
        const gameRoles = await getGameRoles(gameState.gameCode);
        const pedorroValue = gameRoles?.pedorro || 1; // fallback a 1
        
        // 4. Reproducir sonido del pedorro
        await playSoundWebAudio(`pedorro-${pedorroValue}.mp3`, 0);
        
        // 5. Esperar 1.5 segundos adicionales
        await new Promise(resolve => setTimeout(resolve, 1500));
        
    } catch (error) {
        console.error('Error en secuencia de sonidos intro+pedorro:', error);
        // Continuar con el bot贸n de investigar incluso si fallan los sonidos
    }
};
```

## Consideraciones T茅cnicas

### Compatibilidad de Audio
- Mantener soporte para Web Audio API y HTML5 Audio como fallback
- Precarga de archivos para evitar delays
- Manejo de errores robusto

### Performance
- Los sonidos se reproducen solo para el jugador 1
- No afecta la experiencia de otros jugadores
- Timing preciso sin bloquear la UI

### Firebase
- Reutilizar funciones existentes para obtener datos
- No requiere cambios en la estructura de la base de datos
- Mantener consistencia con el patr贸n actual

## Testing

### Casos de Test a Cubrir
1. **Jugador 1**: Secuencia completa de sonidos antes del bot贸n
2. **Otros jugadores**: Timing normal sin sonidos especiales
3. **Fallback de audio**: Si falla intro.mp3 o pedorro-X.mp3
4. **Valores de pedorro**: Diferentes valores (1-5) desde Firebase
5. **Compatibilidad**: Web Audio API vs HTML5 Audio

### Tests Unitarios
- Crear tests para `playIntroAndPedorroSound()`
- Verificar timing y secuencia de sonidos
- Testear manejo de errores y fallbacks

## Impacto en Funcionalidades Existentes

### No Afecta
- Sistema de roles y sonidos actual
- Funcionalidad DISIMULAR para otros jugadores
- Bot贸n de investigar y permisos
- Integraci贸n con Firebase

### Cambios M铆nimos
- Solo modifica el timing de aparici贸n del bot贸n INVESTIGAR
- Mantiene la experiencia inmersiva del juego
- Preserva la arquitectura funcional e inmutable

## Estimaci贸n de Complejidad

**Baja**: Cambios localizados en la secuencia de sonidos, reutilizaci贸n de funciones existentes, no requiere cambios en la base de datos o arquitectura principal.
